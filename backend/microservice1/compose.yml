services:
  # Base de datos MySQL
  ## Descomentar para deploy sin MV DB

  # mysql:
  #   image: mysql:8.0
  #   container_name: maki_mysql
  #   environment:
  #     MYSQL_ROOT_PASSWORD: utec
  #     MYSQL_DATABASE: maki_orders
  #     MYSQL_USER: utecino
  #     MYSQL_PASSWORD: utec
  #   ports:
  #     - "3306:3306"
  #   volumes:
  #     - mysql_data:/var/lib/mysql
  #     - ./init.sql:/docker-entrypoint-initdb.d/init.sql
  #   networks:
  #     - maki_network
  #   healthcheck:
  #     test: [
  #       "CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-putec"
  #     ]
  #     timeout: 30s
  #     retries: 10
  #     start_period: 40s
  #     interval: 10s

  # AplicaciÃ³n FastAPI
  api:
    build: .
    container_name: maki_api
    environment:
      DB_HOST: ${DB_HOST}           
      DB_PORT: ${DB_PORT}           
      DB_USER: ${DB_USER}           
      DB_PASSWORD: ${DB_PASSWORD}   
      DB_NAME: ${DB_NAME}           
    ports:
      - "8000:8000"
    ## Descomentar para deploy sin MV DB
    # depends_on:
    #   mysql:
    #     condition: service_healthy
    volumes:
      - .:/app
    networks:
      - maki_network
    command: >
      sh -c "sleep 10 && 
      uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"

## Descomentar para deploy sin MV DB
# volumes:
#   mysql_data:

networks:
  maki_network:
    driver: bridge